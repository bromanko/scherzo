---
id: s-9f73
status: closed
deps: []
links: []
created: 2026-01-20T03:44:25Z
type: bug
priority: 0
assignee: Brian Romanko
tags: [security, critical]
---
# Fix path traversal vulnerability in checkpoint.gleam

Task IDs are used directly in file path construction in checkpoint.gleam without sanitization, allowing directory traversal attacks.

## Vulnerable Locations
- checkpoint.gleam:133 - save()
- checkpoint.gleam:180 - load_latest()
- checkpoint.gleam:225 - load_all()
- checkpoint.gleam:446 - get_next_sequence()

## Attack Vector
1. Create malicious ticket with id: ../../../tmp/malicious
2. When task runs, checkpoint.save() writes to unintended paths
3. Attacker can write files outside intended directory

## Fix
Apply workspace.sanitize_id() to all task_id parameters:
```gleam
import scherzo/agent/workspace
let task_dir = config.checkpoints_dir <> "/" <> workspace.sanitize_id(checkpoint.task_id)
```

