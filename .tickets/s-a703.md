---
id: s-a703
status: done
deps: [s-a701, s-a702]
links: []
created: 2026-01-22T18:45:00Z
type: task
priority: 2
assignee: Brian Romanko
parent: s-a700
tags: [phase-5g, agent, workspace]
---
# Integrate custom config into workspace creation

Modify `src/scherzo/agent/workspace.gleam` to accept and apply custom agent configurations.

## Changes

1. Update `create()` signature:
   ```gleam
   pub fn create(
     config: WorkspaceConfig,
     task: Task,
     custom_config: Option(AgentCustomConfig),
   ) -> Result(Workspace, String)
   ```

2. Update `write_claude_settings()` to merge custom settings using settings_merger

3. Add `write_claude_instructions()`:
   - Writes to `<workspace_path>/CLAUDE.md` (workspace root, NOT .claude/)

4. Update `destroy()`:
   - Add `jj.restore_file(workspace.path, "CLAUDE.md")`
   - Prevents custom files from polluting commit history

## Acceptance Criteria

- [x] create() accepts optional custom config
- [x] CLAUDE.md written to workspace root when instructions present
- [x] settings.json merged when custom settings present
- [x] destroy() restores both CLAUDE.md and settings.json
- [x] Integration test verifies end-to-end flow
